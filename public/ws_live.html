<html lang="zh">
<head>
    <title></title>
</head>
<body>

<img id="img" src="" alt="">

<script>
    const ws = new WebSocket('ws://tx.kyour.cn:8131/')
    ws.binaryType = "arraybuffer";

    function arrayBufferToBase64(buffer) {
        var binary = '';
        var bytes = new Uint8Array(buffer);
        var len = bytes.byteLength;
        for (var i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        return window.btoa(binary);
    }

    ws.addEventListener('message', (event) => {

        let url= arrayBufferToBase64(event.data);
        document.getElementById('img').src='data:image/jpeg;base64,'+url;

        return;

        if(event.data.length > 100){
            // console.log(event.data)
            // document.getElementById('img')
            //     .setAttribute( 'src', event.data)
        }else{
            console.log('Message from server ', event.data);
        }

        // setTimeout(() => {
        //     //向服务器请求下一帧图片
        //     ws.send("pull:my")
        // }, 500)
    });
    ws.onopen = () => {
        console.log("open")
        ws.send("logi:pull")
    }
    // ws.onmessage = (ws, msg) => {
    //     console.log('message:' + msg)
    // }
    ws.onclose = () => {
        console.log('onclose')
    }
</script>

</body>
</html>